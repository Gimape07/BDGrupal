{"changed":true,"filter":false,"title":"hockey_pack.php","tooltip":"/hockey_pack.php","value":"<?php\n    function connect() {\n        $ENV = \"prod\";\n        if ($ENV == \"dev\") {\n            $mysql = mysqli_connect(\"localhost\",\"pedro\",\"pedroperez\",\"tienda\");\n                                            //root si estan en windows\n        } else  if ($ENV == \"prod\"){\n            $mysql = mysqli_connect(\"localhost\",\"diagsrmd\",\"\",\"tienda\");\n        }\n        \n        $mysql->set_charset(\"utf8\");\n        return $mysql;\n    }\n    \n    function disconnect($mysql) {\n        mysqli_close($mysql);\n    }\n    \n    function login($user, $password) {\n        $db = connect();\n        if ($db != NULL) {\n            \n            //Specification of the SQL query\n            $query='SELECT nombre FROM usuarios WHERE nombre=\"'.$user.\n                '\" AND password=\"'.$password.'\"';\n            $query;\n             // Query execution; returns identifier of the result group\n            $results = $db->query($query);\n             // cycle to explode every line of the results\n             \n            if (mysqli_num_rows($results) > 0)  {\n                // it releases the associated results\n                mysqli_free_result($results);\n                disconnect($db);\n                return true;\n            }\n            return false;\n        } \n        return false;\n    }\n    \n    function crearProducto($nombre, $imagen) {\n        $db = connect();\n        if ($db != NULL) {\n            \n            // insert command specification \n            $query='INSERT INTO productos (nombre,imagen) VALUES (?,?) ';\n            // Preparing the statement \n            if (!($statement = $db->prepare($query))) {\n                die(\"Preparation failed: (\" . $db->errno . \") \" . $db->error);\n            }\n            // Binding statement params \n            if (!$statement->bind_param(\"ss\", $nombre, $imagen)) {\n                die(\"Parameter vinculation failed: (\" . $statement->errno . \") \" . $statement->error); \n            }\n             // Executing the statement\n             if (!$statement->execute()) {\n                die(\"Execution failed: (\" . $statement->errno . \") \" . $statement->error);\n              } \n\n            \n            mysqli_free_result($results);\n            disconnect($db);\n            return true;\n        } \n        return false;\n    }\n    \n    function editarProducto($nombre, $id){\n        $db = connect();\n        if ($db != NULL) {\n            // update command specification\n            $query='UPDATE productos SET nombre=? WHERE id=?';\n            if (!($statement = $db->prepare($query))) {\n                die(\"The preparation failed: (\" . $db->errno . \") \" . $db->error);\n            }\n            // Binding statement params\n            if (!$statement->bind_param(\"ss\", $nombre, $id)) {\n                die(\"Parameter vinculation failed: (\" . $statement->errno . \") \" . $statement->error);\n            } \n            // update execution\n            if ($statement->execute()) {\n                echo 'There were ' . mysqli_affected_rows($db) . ' affected rows';\n            } else {\n                die(\"Update failed: (\" . $statement->errno . \") \" . $statement->error);\n            }\n            mysqli_free_result($results);\n            disconnect($db);\n            return true;\n        }\n        return false;\n    }\n    \n    function eliminarProducto($id){\n        $db = connect();\n        if ($db != NULL) {\n            // Deletion query construction\n            $query = 'DELETE FROM productos WHERE id=?';\n            if (!($statement = $db->prepare($query))) {\n                die(\"The preparation failed: (\" . $db->errno . \") \" . $db->error);\n            }\n            // Binding statement params\n            if (!$statement->bind_param(\"s\", $id)) {\n                die(\"Parameter vinculation failed: (\" . $statement->errno . \") \" . $statement->error);\n            } \n            // delete execution\n            if ($statement->execute()) {\n                echo 'There were ' . mysqli_affected_rows($db) . ' affected rows';\n            } else {\n                die(\"Update failed: (\" . $statement->errno . \") \" . $statement->error);\n            }\n            mysqli_free_result($results);\n            disconnect($db);\n            return true;\n        }\n        return false;\n    }\n    \n    function getTable($tabla) {\n        $db = connect();\n        if ($db != NULL) {\n            \n            //Specification of the SQL query\n            $query='SELECT * FROM '.$tabla;\n            $query;\n             // Query execution; returns identifier of the result group\n            $results = $db->query($query);\n             // cycle to explode every line of the results\n        \n           $html = '<table class=\"striped\">';\n           $html .= '<thead>';\n           $html .= '<tr>';\n           $columnas = $results->fetch_fields();\n           for($i=0; $i<count($columnas); $i++) {\n                $html .= '<th>'.$columnas[$i]->name.'</th>';\n           }\n           $html .= '</tr>';\n           $html .= '</thead>';\n           \n           $html .= '<tbody>';\n           while ($fila = mysqli_fetch_array($results, MYSQLI_BOTH)) {\n                                                // Options: MYSQLI_NUM to use only numeric indexes\n                                                // MYSQLI_ASSOC to use only name (string) indexes\n                                                // MYSQLI_BOTH, to use both\n                    $html .= '<tr>';\n                    for($i=0; $i<count($fila); $i++) {\n                        // use of numeric index\n                        $html .= '<td>'.$fila[$i].'</td>'; \n                    }\n                    $html .= '</tr>';\n            }\n            $html .= '</tbody></table>';   \n            // it releases the associated results\n            mysqli_free_result($results);\n            disconnect($db);\n            return $html;\n        }\n        return false;\n    }\n    \n    function getProductos() {\n        $db = connect();\n        if ($db != NULL) {\n            \n            //Specification of the SQL query\n            $query='SELECT * FROM productos';\n            $query;\n             // Query execution; returns identifier of the result group\n            $results = $db->query($query);\n             // cycle to explode every line of the results\n            $html = '';\n           while ($fila = mysqli_fetch_array($results, MYSQLI_BOTH)) {\n                                                // Options: MYSQLI_NUM to use only numeric indexes\n                                                // MYSQLI_ASSOC to use only name (string) indexes\n                                                // MYSQLI_BOTH, to use both\n                    $html .= '<div class=\"row\">\n                                <div class=\"col s12 m7\">\n                                  <div class=\"card\">\n                                    <div class=\"card-image\">\n                                      <img src=\"uploads/'.$fila[\"imagen\"].'\">\n                                      <span class=\"card-title\">'.$fila[\"nombre\"].'</span>\n                                    </div>\n                                    <div class=\"card-content\">\n                                      <p>Publicado el: '.$fila[\"created_at\"].'.</p>\n                                    </div>\n                                    <div class=\"card-action\">\n                                      <a href=\"editar.php?id='.$fila[\"id\"].'\">Editar</a>\n                                      <a href=\"delete.php?id='.$fila[\"id\"].'\">Eliminar</a>\n                                    </div>\n                                  </div>\n                                </div>\n                              </div>';\n            }\n            echo $html;\n            // it releases the associated results\n            mysqli_free_result($results);\n            disconnect($db);\n            return true;\n        }\n        return true;\n    }\n    \n    function getProducto($id) {\n        $db = connect();\n        if ($db != NULL) {\n            \n            //Specification of the SQL query\n            $query='SELECT * FROM productos WHERE id='.$id;\n            $query;\n             // Query execution; returns identifier of the result group\n            $results = $db->query($query);\n             // cycle to explode every line of the results\n            $html = '';\n            $fila = mysqli_fetch_array($results, MYSQLI_BOTH);\n            $html .= '<div class=\"row\">\n                                <div class=\"col s12 m7\">\n                                  <div class=\"card\">\n                                    <div class=\"card-image\">\n                                      <img src=\"uploads/'.$fila[\"imagen\"].'\">\n                                    </div>\n                                    <div class=\"card-content\">\n                                      <p>Publicado el: '.$fila[\"created_at\"].'.</p>\n                                    </div>\n                                  </div>\n                                </div>\n                              </div>';\n            echo $html;\n            // it releases the associated results\n            mysqli_free_result($results);\n            disconnect($db);\n            return true;\n        }\n        return true;\n    }\n    \n    \n    \n    \n    //echo getTable(\"usuarios\");\n    //echo getTable(\"productos\");\n\n?>\n","undoManager":{"mark":-2,"position":0,"stack":[[{"start":{"row":233,"column":5},"end":{"row":234,"column":0},"action":"insert","lines":["",""],"id":2},{"start":{"row":234,"column":0},"end":{"row":234,"column":4},"action":"insert","lines":["    "]}]]},"ace":{"folds":[],"scrolltop":2486,"scrollleft":0,"selection":{"start":{"row":234,"column":4},"end":{"row":234,"column":4},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":422,"mode":"ace/mode/php"}},"timestamp":1520574515008}